(function(){var g,c,f,h,i,e;i=require("pebblecore");e=require("underscore");c=require("backbone");g=function(a,b){if(!a.hasOwnProperty(b))throw Error("Invalid namespace for collection "+this.constructor.name+': "'+b+'" (missing key in response)');return!0};e.extend(c.Model.prototype,{parse:function(a){var b;return(b=this.namespace)&&g(a,b)?a[b]:a},toJSON:function(){var a,b,d;b=this.namespace;a=e.clone(this.attributes);return b?(d={},d[b]=a,d):a},getAttributes:function(){return e.clone(this.attributes)}});
e.extend(c.Model.prototype,{parse:function(a){var b,d,e,c,f;(b=this.namespace)&&g(a,b)&&(a=a[b]);d=this.model.prototype.namespace;e=[];if(d)for(c=0,f=a.length;c<f;c++)b=a[c],g(b,d),null!==b[d]&&e.push(b[d]);return e},toJSON:function(){return e.clone(this.attributes)},getAttributes:function(){return this.map(function(a){return a.getAttributes()})}});c.VERSION+=".pebbles";f=function(a){return!a||!a.url?null:e.isFunction(a.url)?a.url():a.url};h={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};
c.sync=function(a,b,d){var c;c={};if(!d.data&&b&&("create"===a||"update"===a))c["Content-Type"]="application/json",d.data=JSON.stringify(b.toJSON());a=i.state.connector.perform(h[a],f(b),d.data,c);a.then(d.success,d.error);return a}}).call(this);
